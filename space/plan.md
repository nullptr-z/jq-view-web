# jq-view 最小实现方案

## 核心定位

一个交互式的 jq 可视化工具，让用户通过 TUI（终端图形界面）快速选择和过滤 JSON 字段。

## MVP 功能范围

### 第一阶段：核心功能（最小实现）

1. **JSON 输入**
   - 从 stdin 读取 JSON
   - 从文件读取 JSON

2. **交互式字段选择**
   - 树形展示 JSON 结构
   - 键盘导航（上下左右展开/折叠）
   - 空格键选择/取消字段
   - 实时预览选中字段的 jq 表达式

3. **多种输出格式**
   - **简化 JSON** - 只包含选中字段的精简结构
   - **Table** - 表格形式展示（适合数组数据）
   - 显示对应的 jq 命令（方便用户复用）

### 暂不实现（后续迭代）

- YAML/TOML 格式转换
- CSV 文件导出
- 复杂 jq 表达式（map、filter 等）

## 技术选型

| 组件 | 选择 | 理由 |
|------|------|------|
| 语言 | Go | 单二进制分发、跨平台、性能好 |
| 前端 | 内嵌 HTML + Vue 3 (CDN) | 无需构建、单文件嵌入 |
| JSON 处理 | 标准库 + [gojq](https://github.com/itchyny/gojq) | gojq 是 jq 的纯 Go 实现 |

## 项目结构

```
jq-view/
├── main.go              # 入口 + HTTP 服务
├── internal/
│   ├── web/
│   │   ├── handler.go   # API 处理
│   │   └── index.html   # 前端页面（内嵌）
│   └── jq/
│       └── builder.go   # jq 表达式执行
├── go.mod
└── go.sum
```

## 交互设计（Web UI）

```
┌─────────────────────────────────────────────────────────────┐
│  jq-view                                    [JSON ▼] [复制] │
├─────────────────────────────────────────────────────────────┤
│  ┌─ 输入 ─────────────┐  ┌─ 输出 ─────────────────────────┐ │
│  │ ▼ root             │  │ [                              │ │
│  │   ▼ users [3]      │  │   {"name": "张三", "city": "北京"},│ │
│  │     ▼ [0]          │  │   {"name": "李四", "city": "上海"} │ │
│  │       ☑ name       │  │ ]                              │ │
│  │       ☐ age        │  │                                │ │
│  │       ☑ city       │  │                                │ │
│  │       ☐ email      │  │                                │ │
│  │     ▶ [1]          │  │                                │ │
│  │     ▶ [2]          │  │                                │ │
│  └────────────────────┘  └────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  jq: .[] | {name, city}                                     │
└─────────────────────────────────────────────────────────────┘
```

### 输出格式示例

**1. 简化 JSON 输出**（只保留选中字段的结构）
```json
[
  {"name": "张三", "city": "北京"},
  {"name": "李四", "city": "上海"}
]
```

**2. Table 输出**
```
┌────────┬────────┐
│ name   │ city   │
├────────┼────────┤
│ 张三   │ 北京   │
│ 李四   │ 上海   │
└────────┴────────┘
```

## 使用方式

```bash
# 交互模式（默认）
cat data.json | jq-view
jq-view data.json

# 指定输出格式
jq-view data.json -o json    # 简化 JSON（默认）
jq-view data.json -o table   # 表格输出
```

## 实现步骤

1. **搭建项目骨架** - 初始化 Go 模块，引入依赖
2. **实现 JSON 树解析** - 将 JSON 转换为可遍历的树结构
3. **实现基础 TUI** - 显示树、键盘导航
4. **实现字段选择** - 多选逻辑、jq 表达式生成
5. **实现输出** - 执行 jq 并输出结果

## 下一步

确认方案后，我可以开始实现第一步：搭建项目骨架。
