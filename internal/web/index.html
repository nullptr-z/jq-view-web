<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>jq-view</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div id="app" class="app">
    <div class="header">
      <div class="brand">
        <div class="brand-icon">
          <svg height="24" viewBox="0 0 16 16" width="24"><path fill="#fff" d="M8.5 1.75a.75.75 0 00-1.5 0V5H4a.75.75 0 000 1.5h3v3.25a.75.75 0 001.5 0V6.5H12A.75.75 0 0012 5H8.5V1.75z"/><path fill="#fff" d="M5 9.5a.75.75 0 01.75.75v2.25h2.5a.75.75 0 010 1.5h-3.5a.75.75 0 01-.75-.75v-3a.75.75 0 01.75-.75z"/></svg>
        </div>
        <span>jq-view</span>
      </div>
      <div class="actions">
        <select class="btn" v-model="format">
          <option value="json">JSON</option>
          <option value="table">Table</option>
        </select>
        <button class="btn" @click="copyResult">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
          Copy
        </button>
      </div>
    </div>

    <div class="main">
      <div class="sidebar">
        <!-- File List (only in directory mode) -->
        <div v-if="dirMode" class="file-section">
          <div class="sidebar-header">
            <span>Files</span>
            <div class="sidebar-actions">
              <span @click="refreshFileList">Refresh</span>
            </div>
          </div>
          <div class="file-list">
            <div
              v-for="file in fileList"
              :key="file"
              class="file-item"
              :class="{ active: file === currentFile }"
              @click="loadFile(file)"
            >
              <svg class="file-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
              </svg>
              <span class="file-item-name">{{ file }}</span>
            </div>
          </div>
        </div>

        <div class="sidebar-header">
          <span>Struct</span>
          <div class="sidebar-actions">
            <span @click="dragEnabled = !dragEnabled" :class="{ active: dragEnabled }">{{ dragEnabled ? 'Drag On' : 'Drag' }}</span>
            <span @click="expandAll">Expand</span>
            <span @click="collapseAll">Collapse</span>
            <span @click="collapseEmpty">Focus</span>
          </div>
        </div>
        <div class="tree-container">
          <tree-node
            v-if="tree"
            :node="tree"
            :depth="0"
            :index="0"
            :parent-children="null"
            :drag-enabled="dragEnabled"
            @toggle="toggleNode"
            @select="selectNode"
            @reorder="handleReorder"
            @move-into="handleMoveInto"
          />
        </div>
      </div>

      <div class="output">
        <div class="output-header">
          <span class="output-title">Output</span>
          <div class="output-options">
            <div class="toggle-switch" @click="compressPath = !compressPath">
              <span class="toggle-switch-label">Full Path</span>
              <div class="toggle-switch-track" :class="{ active: !compressPath }">
                <div class="toggle-switch-thumb"></div>
              </div>
            </div>
            <span class="output-badge">{{ format.toUpperCase() }}</span>
          </div>
        </div>
        <div class="output-content">
          <pre :class="{ error: !!error }">{{ error || result }}</pre>
        </div>
      </div>
    </div>

    <div class="footer">
      <span class="jq-label">jq</span>
      <input
        class="jq-input"
        v-model="expression"
        @keyup.enter="runQuery"
        placeholder="Enter jq expression..."
      >
      <button class="btn btn-primary" @click="runQuery">Run</button>
    </div>
  </div>

  <script src="/app.js"></script>
  <script>
    initApp({{INITIAL_DATA}}, {{DIR_MODE}}, '{{CURRENT_FILE}}');
  </script>
</body>
</html>
